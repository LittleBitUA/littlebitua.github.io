---
// ─── Header ────────────────────────────────────────────────────
// Floating pill-style navbar, centered, minimal and premium.

import { getOverallProgress } from "../data/games";
const overall = getOverallProgress();
---

<header id="site-header" class="fixed top-0 left-0 right-0 z-50 pt-4 px-4 transition-all duration-500">
  <nav class="mx-auto max-w-3xl">
    <div class="header-pill flex items-center justify-between h-12 px-2 rounded-2xl
                bg-surface-800/60 backdrop-blur-xl border border-white/[0.06]
                shadow-lg shadow-black/20 transition-all duration-500">

      <!-- Logo -->
      <a href="#" class="flex items-center gap-2 px-2 group shrink-0">
        <div class="w-7 h-7 rounded-lg bg-[#1a1a1a] border border-white/10
                    flex items-center justify-center
                    group-hover:shadow-md group-hover:shadow-white/10 transition-all duration-300 overflow-hidden">
          <svg viewBox="0 0 40 40" class="w-full h-full">
            <rect width="40" height="40" rx="8" fill="#1a1a1a"/>
            <text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle"
                  font-family="Inter, system-ui, sans-serif" font-weight="900" font-size="20" fill="white"
                  letter-spacing="-1">LB</text>
          </svg>
        </div>
        <span class="text-white font-bold text-sm hidden sm:block">
          «Little Bit»
        </span>
      </a>

      <!-- Center nav links -->
      <div class="hidden md:flex items-center gap-1">
        <a href="#projects" class="nav-link px-3 py-1.5 text-xs font-medium text-surface-300 hover:text-white
                                   rounded-lg hover:bg-white/[0.06] transition-all duration-200">
          Проєкти
        </a>
        <a href="#progress" class="nav-link px-3 py-1.5 text-xs font-medium text-surface-300 hover:text-white
                                   rounded-lg hover:bg-white/[0.06] transition-all duration-200">
          Прогрес
        </a>
        <a href="#updates" class="nav-link px-3 py-1.5 text-xs font-medium text-surface-300 hover:text-white
                                  rounded-lg hover:bg-white/[0.06] transition-all duration-200">
          Оновлення
        </a>
      </div>

      <!-- Right side -->
      <div class="flex items-center gap-2">
        <!-- Mini progress indicator -->
        <div class="hidden lg:flex items-center gap-2 px-2.5 py-1 rounded-lg bg-white/[0.04] border border-white/[0.06]">
          <div class="w-16 h-1 rounded-full bg-surface-600 overflow-hidden">
            <div class="h-full rounded-full bg-gradient-to-r from-accent to-steam-blue" style={`width: ${overall}%`} />
          </div>
          <span class="text-[10px] font-bold text-surface-300 tabular-nums">{overall}%</span>
        </div>

        <!-- Donate button -->
        <a
          href="https://send.monobank.ua/jar/3h4akVJRXK"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 px-3.5 py-1.5 text-xs font-semibold
                 bg-accent/15 text-accent-light border border-accent/25 rounded-xl
                 hover:bg-accent/25 hover:border-accent/40 transition-all duration-200"
        >
          <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
          </svg>
          <span class="hidden sm:inline">Підтримати</span>
        </a>

        <!-- Mobile toggle -->
        <button
          id="mobile-toggle"
          class="md:hidden flex items-center justify-center w-8 h-8 rounded-lg
                 text-surface-300 hover:text-white hover:bg-white/[0.06] transition-all duration-200"
          aria-label="Меню"
        >
          <svg id="burger-icon" class="w-4 h-4 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg id="close-icon" class="w-4 h-4 hidden transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile dropdown -->
    <div id="mobile-menu"
         class="md:hidden overflow-hidden transition-all duration-300"
         style="max-height: 0; opacity: 0;">
      <div class="mt-2 p-3 rounded-2xl bg-surface-800/80 backdrop-blur-xl border border-white/[0.06]
                  shadow-lg shadow-black/20 space-y-1">
        <a href="#projects" class="mobile-link block px-4 py-2.5 text-sm text-surface-300 hover:text-white
                                   rounded-xl hover:bg-white/[0.06] transition-all duration-200">
          Проєкти
        </a>
        <a href="#progress" class="mobile-link block px-4 py-2.5 text-sm text-surface-300 hover:text-white
                                   rounded-xl hover:bg-white/[0.06] transition-all duration-200">
          Прогрес
        </a>
        <a href="#updates" class="mobile-link block px-4 py-2.5 text-sm text-surface-300 hover:text-white
                                  rounded-xl hover:bg-white/[0.06] transition-all duration-200">
          Оновлення
        </a>
      </div>
    </div>
  </nav>
</header>

<style>
  /* Active nav link highlight based on scroll position */
  .nav-link.active {
    color: white;
    background: rgba(255, 255, 255, 0.06);
  }

  /* Shrink pill on scroll */
  .header-scrolled .header-pill {
    background: rgba(13, 17, 23, 0.85);
    border-color: rgba(255, 255, 255, 0.08);
  }
</style>

<script>
  const header = document.getElementById("site-header")!;
  const menu = document.getElementById("mobile-menu")!;
  const toggle = document.getElementById("mobile-toggle")!;
  const burgerIcon = document.getElementById("burger-icon")!;
  const closeIcon = document.getElementById("close-icon")!;
  let isOpen = false;

  // ── Scroll: add background ──
  const onScroll = () => {
    header.classList.toggle("header-scrolled", window.scrollY > 32);
  };
  window.addEventListener("scroll", onScroll, { passive: true });
  onScroll();

  // ── Active section highlight ──
  const sections = document.querySelectorAll("section[id]");
  const navLinks = document.querySelectorAll<HTMLAnchorElement>(".nav-link");

  const highlightNav = () => {
    let current = "";
    sections.forEach((section) => {
      const top = section.getBoundingClientRect().top;
      if (top <= 120) current = section.id;
    });
    navLinks.forEach((link) => {
      link.classList.toggle("active", link.getAttribute("href") === `#${current}`);
    });
  };
  window.addEventListener("scroll", highlightNav, { passive: true });

  // ── Mobile menu ──
  toggle.addEventListener("click", () => {
    isOpen = !isOpen;
    if (isOpen) {
      menu.style.maxHeight = menu.scrollHeight + "px";
      menu.style.opacity = "1";
      burgerIcon.classList.add("hidden");
      closeIcon.classList.remove("hidden");
    } else {
      menu.style.maxHeight = "0";
      menu.style.opacity = "0";
      burgerIcon.classList.remove("hidden");
      closeIcon.classList.add("hidden");
    }
  });

  menu.querySelectorAll(".mobile-link").forEach((link) => {
    link.addEventListener("click", () => {
      isOpen = false;
      menu.style.maxHeight = "0";
      menu.style.opacity = "0";
      burgerIcon.classList.remove("hidden");
      closeIcon.classList.add("hidden");
    });
  });
</script>
